# Databricks Asset Bundle Configuration for MCP Workshop
bundle:
  name: mcp-workshop
  
variables:
  # Workshop configuration variables
  workshop_name:
    description: "Name of the MCP workshop"
    default: "Databricks MCP Workshop"

  app_name:
    description: "Name of the Databricks App"
    default: "mcp-workshop-app"

  participant_prefix:
    description: "Participant prefix for resource naming"
    default: "default"

  workshop_catalog:
    description: "Workshop catalog name"
    default: "mcp_workshop"

  mcp_server_name:
    description: "Custom MCP server name"
    default: "databricks-mcp-workshop"

targets:
  # Development target for testing
  dev:
    mode: development
    default: true
    variables:
      app_name: "mcp-workshop-app-dev"
    
  # Production target for workshop deployment
  prod:
    mode: production
    variables:
      app_name: "mcp-workshop-app"

resources:
  # Databricks Apps for the workshop
  apps:
    # Custom MCP server for hands-on learning
    mcp_server_app:
      name: ${var.mcp_server_name}
      description: "Custom MCP server for workshop participant: ${var.participant_prefix}"

      # Custom MCP server code
      source_code_path: "/Workspace/Users/${workspace.current_user.userName}/${var.mcp_server_name}"

      # Permissions - participant-specific
      permissions:
        - level: CAN_USE
          group_name: "users"

  # Jobs for workshop setup and teardown
  jobs:
    setup_workshop_resources:
      name: "Setup MCP Workshop Resources"
      description: "Sets up Unity Catalog resources needed for the workshop"

      tasks:
        - task_key: "create_catalog"
          notebook_task:
            notebook_path: "./setup/create_workshop_catalog.py"
            base_parameters:
              catalog_name: "${var.workshop_catalog}"

        - task_key: "setup_sample_data"
          depends_on:
            - task_key: "create_catalog"
          notebook_task:
            notebook_path: "./setup/setup_sample_data.py"
            base_parameters:
              catalog_name: "${var.workshop_catalog}"

        - task_key: "deploy_mcp_template"
          depends_on:
            - task_key: "setup_sample_data"
          notebook_task:
            notebook_path: "./setup/deploy_mcp_template.py"
            base_parameters:
              participant_prefix: "${var.participant_prefix}"
              mcp_server_name: "${var.mcp_server_name}"

    cleanup_workshop_resources:
      name: "Cleanup MCP Workshop Resources"
      description: "Cleans up Unity Catalog resources created for the workshop"
      
      tasks:
        - task_key: "cleanup_resources"
          notebook_task:
            notebook_path: "./setup/cleanup_workshop_resources.py"
            base_parameters:
              catalog_name: "${var.workshop_catalog}"

include:
  - resources/*.yml
